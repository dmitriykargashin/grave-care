import{d as I,a0 as B,a1 as G,r as v,k as K,a2 as Q,N as k,C as t,a3 as z,y as f,B as e,P as R,D as i,M as y,J as l,A as T,K as S,a4 as W,Y as O,Z as P,_ as p,V as N,G as j,I as Y,x as F,$ as M,z as $,Q as Z,R as H,S as X,T as h,O as ee,U as te,W as ae,L as le}from"./DSoo6jVJ.js";import{b as oe,c as se,d as re,u as ne,a as de,V as U}from"./BxkK-uK3.js";import{V as ie}from"./BNw2KUzE.js";const ue=I({__name:"CemeteryDialog",props:B({cemetery:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:B(["saved"],["update:modelValue"]),setup(A,{emit:C}){const g=A,E=C,x=G(A,"modelValue"),w=v(),u=v(!1),s=K(()=>!!g.cemetery?.id),r=v({name:"",address:""}),V=j("showSnackbar");Q(()=>g.cemetery,m=>{m?r.value={name:m.name,address:m.address||""}:_()},{immediate:!0});function _(){r.value={name:"",address:""}}function b(){x.value=!1,_()}async function D(){const{valid:m}=await w.value.validate();if(m){u.value=!0;try{const o=s.value?`/api/cemeteries/${g.cemetery.id}`:"/api/cemeteries",n=s.value?"PUT":"POST",L=await $fetch(o,{method:n,body:r.value});E("saved",L),V?.(`Cemetery ${s.value?"updated":"created"} successfully`),b()}catch(o){console.error("Error saving cemetery:",o),V?.("Failed to save cemetery","error")}finally{u.value=!1}}}return(m,o)=>(f(),k(z,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=n=>x.value=n),"max-width":"500",persistent:""},{default:t(()=>[e(N,null,{default:t(()=>[e(R,{class:"d-flex align-center"},{default:t(()=>[e(y,{icon:l(s)?"mdi-pencil":"mdi-plus",class:"mr-2"},null,8,["icon"]),i(" "+T(l(s)?"Edit Cemetery":"New Cemetery"),1)]),_:1}),e(S,null,{default:t(()=>[e(oe,{ref_key:"formRef",ref:w,onSubmit:W(D,["prevent"])},{default:t(()=>[e(se,{modelValue:l(r).name,"onUpdate:modelValue":o[0]||(o[0]=n=>l(r).name=n),label:"Cemetery Name",rules:[n=>!!n||"Name is required"],required:""},null,8,["modelValue","rules"]),e(re,{modelValue:l(r).address,"onUpdate:modelValue":o[1]||(o[1]=n=>l(r).address=n),label:"Address",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),e(O,null,{default:t(()=>[e(P),e(p,{variant:"text",onClick:b},{default:t(()=>[...o[3]||(o[3]=[i("Cancel",-1)])]),_:1}),e(p,{color:"primary",loading:l(u),onClick:D},{default:t(()=>[i(T(l(s)?"Save":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),me=Object.assign(ue,{__name:"CemeteryDialog"}),pe=I({__name:"cemeteries",async setup(A){let C,g;const{data:E,pending:x,refresh:w}=([C,g]=Y(()=>ne("/api/cemeteries","$S7IxEoJr7z")),C=await C,g(),C),u=v(!1),s=v(!1),r=v(null),V=v(null),_=v(!1),b=j("showSnackbar");function D(){r.value=null,u.value=!0}function m(c){r.value=c,u.value=!0}function o(){w()}function n(c){V.value=c,s.value=!0}async function L(){if(V.value){_.value=!0;try{await $fetch(`/api/cemeteries/${V.value.id}`,{method:"DELETE"}),b?.("Cemetery deleted"),w(),s.value=!1}catch(c){console.error("Error deleting cemetery:",c);const a=c instanceof Error?c.message:"Failed to delete cemetery";b?.(a,"error")}finally{_.value=!1}}}return(c,a)=>{const q=me;return f(),F("div",null,[e(N,{class:"mb-4"},{default:t(()=>[e(S,null,{default:t(()=>[e(de,{align:"center"},{default:t(()=>[e(U,null,{default:t(()=>[...a[3]||(a[3]=[$("div",{class:"text-h6"},"Cemeteries",-1),$("div",{class:"text-body-2 text-medium-emphasis"}," Manage cemetery locations ",-1)])]),_:1}),e(U,{cols:"auto"},{default:t(()=>[e(p,{color:"primary",onClick:D},{default:t(()=>[e(y,{icon:"mdi-plus",start:""}),a[4]||(a[4]=i(" New Cemetery ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(N,null,{default:t(()=>[l(x)?(f(),k(S,{key:0},{default:t(()=>[e(ie,{type:"list-item-two-line@5"})]),_:1})):l(E)?.length?(f(),k(Z,{key:1},{default:t(()=>[(f(!0),F(H,null,X(l(E),d=>(f(),k(h,{key:d.id},{prepend:t(()=>[e(le,{color:"primary"},{default:t(()=>[e(y,{icon:"mdi-map-marker"})]),_:1})]),append:t(()=>[e(p,{icon:"",variant:"text",size:"small",onClick:J=>m(d)},{default:t(()=>[e(y,{icon:"mdi-pencil"})]),_:1},8,["onClick"]),e(p,{icon:"",variant:"text",size:"small",color:"error",onClick:J=>n(d)},{default:t(()=>[e(y,{icon:"mdi-delete"})]),_:1},8,["onClick"])]),default:t(()=>[e(te,{class:"font-weight-medium"},{default:t(()=>[i(T(d.name),1)]),_:2},1024),d.address?(f(),k(ae,{key:0},{default:t(()=>[i(T(d.address),1)]),_:2},1024)):ee("",!0)]),_:2},1024))),128))]),_:1})):(f(),k(S,{key:2,class:"text-center py-8"},{default:t(()=>[e(y,{icon:"mdi-map-marker",size:"64",color:"grey-lighten-1"}),a[6]||(a[6]=$("div",{class:"text-h6 mt-4"},"No cemeteries yet",-1)),a[7]||(a[7]=$("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add your first cemetery location ",-1)),e(p,{color:"primary",onClick:D},{default:t(()=>[e(y,{icon:"mdi-plus",start:""}),a[5]||(a[5]=i(" Add Cemetery ",-1))]),_:1})]),_:1}))]),_:1}),e(q,{modelValue:l(u),"onUpdate:modelValue":a[0]||(a[0]=d=>M(u)?u.value=d:null),cemetery:l(r),onSaved:o},null,8,["modelValue","cemetery"]),e(z,{modelValue:l(s),"onUpdate:modelValue":a[2]||(a[2]=d=>M(s)?s.value=d:null),"max-width":"400"},{default:t(()=>[e(N,null,{default:t(()=>[e(R,{class:"d-flex align-center"},{default:t(()=>[e(y,{icon:"mdi-alert",color:"error",class:"mr-2"}),a[8]||(a[8]=i(" Delete Cemetery ",-1))]),_:1}),e(S,null,{default:t(()=>[i(' Are you sure you want to delete "'+T(l(V)?.name)+'"? This action cannot be undone. ',1)]),_:1}),e(O,null,{default:t(()=>[e(P),e(p,{variant:"text",onClick:a[1]||(a[1]=d=>s.value=!1)},{default:t(()=>[...a[9]||(a[9]=[i("Cancel",-1)])]),_:1}),e(p,{color:"error",loading:l(_),onClick:L},{default:t(()=>[...a[10]||(a[10]=[i(" Delete ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{pe as default};
