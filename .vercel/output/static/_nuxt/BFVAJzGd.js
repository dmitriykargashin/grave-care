import{_ as xe,T as Z,a as Ce}from"./DHKPLmpm.js";import{d as Ve,aq as we,ao as M,r as v,k as Se,x as C,B as e,W as m,C as t,J as p,_ as a,N as R,X as V,P as _,V as B,ar as De,Z as A,af as Q,G as W,y as i,D as o,M as u,aj as w,z as f,A as d,$ as I,a0 as X,ak as k,I as y,a3 as be,as as Pe,O as Y,a5 as H,a6 as S,a7 as D,a9 as b,an as h,at as Te,K as ee,ap as te,ad as $e}from"./CqnZqnHT.js";import{u as le}from"./CPSzfpNf.js";import{_ as Ie}from"./DlAUqK2U.js";const he={class:"text-h5"},Ue={class:"text-body-1 text-capitalize"},Ee={class:"text-body-1"},Fe={class:"text-body-1",style:{"white-space":"pre-wrap"}},Ne={key:0,class:"text-center py-4"},ze={key:2,class:"text-center text-medium-emphasis py-8"},Ae=Ve({__name:"[id]",async setup(Le){let c,U;const E=we().params.id,{data:n,pending:ae,refresh:O}=([c,U]=M(()=>le(`/api/tasks/${E}`,"$2DSv-3zRoY")),c=await c,U(),c),{data:G,pending:oe,refresh:j}=([c,U]=M(()=>le(`/api/tasks/${E}/photos`,"$8ZJymoJw1j")),c=await c,U(),c),F=v(!1),P=v(!1),T=v(!1),$=v(null),J=v(),N=v(null),g=v(""),L=v(!1),x=W("showSnackbar"),ne=W("showComingSoon"),se=[{value:"in_progress",title:"Start",color:"orange"},{value:"done",title:"Complete",color:"success"},{value:"canceled",title:"Cancel",color:"error"}],re=Se(()=>!n.value?.scheduledFor||n.value.status==="done"||n.value.status==="canceled"?!1:new Date(n.value.scheduledFor)<new Date(new Date().toDateString()));function ue(s){return Z.find(l=>l.value===s)?.color||"grey"}function ie(s){return Z.find(l=>l.value===s)?.title||s}function de(s){return Ce.find(l=>l.value===s)?.color||"grey"}function fe(s){return s?new Date(s).toLocaleDateString():"Not scheduled"}function me(s){return new Date(s).toLocaleString()}function pe(){F.value=!0}async function ce(s){try{await $fetch(`/api/tasks/${E}/status`,{method:"POST",body:{status:s}}),x?.("Status updated"),O()}catch(l){console.error("Error updating status:",l),x?.("Failed to update status","error")}}function ve(){J.value?.click()}function _e(s){const l=s.target,z=l.files?.[0];z&&(N.value=z,g.value="",T.value=!0,l.value="")}function K(){N.value=null,g.value="",T.value=!1}async function ke(){if(N.value){L.value=!0;try{const s=new FormData;s.append("file",N.value);const{blobUrl:l}=await $fetch("/api/photos/upload",{method:"POST",body:s});await $fetch(`/api/tasks/${E}/photos`,{method:"POST",body:{blobUrl:l,caption:g.value||null}}),x?.("Photo uploaded successfully"),j(),K()}catch(s){console.error("Error uploading photo:",s),x?.("Failed to upload photo","error")}finally{L.value=!1}}}function ye(s){$.value=s,P.value=!0}async function ge(s){if(confirm("Delete this photo?"))try{await $fetch(`/api/task-photos/${s}`,{method:"DELETE"}),x?.("Photo deleted"),j()}catch(l){console.error("Error deleting photo:",l),x?.("Failed to delete photo","error")}}return(s,l)=>{const z=xe;return i(),C("div",null,[e(p,{variant:"text",class:"mb-4",to:"/tasks"},{default:t(()=>[e(u,{icon:"mdi-arrow-left",start:""}),l[6]||(l[6]=o(" Back to Tasks ",-1))]),_:1}),a(ae)?(i(),m(te,{key:0,type:"article"})):a(n)?(i(),C(R,{key:1},[e(_,{class:"mb-4"},{default:t(()=>[e(w,{class:"d-flex align-center flex-wrap ga-2"},{default:t(()=>[f("span",he,d(a(n).title),1),e(I),e(X,{color:ue(a(n).status),size:"small"},{default:t(()=>[o(d(ie(a(n).status)),1)]),_:1},8,["color"]),e(X,{color:de(a(n).priority),size:"small",variant:"outlined"},{default:t(()=>[o(d(a(n).priority),1)]),_:1},8,["color"]),e(p,{icon:"",variant:"text",onClick:pe},{default:t(()=>[e(u,{icon:"mdi-pencil"})]),_:1})]),_:1}),e(k,null,{default:t(()=>[e(B,null,{default:t(()=>[e(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[7]||(l[7]=f("div",{class:"text-caption text-medium-emphasis"},"Type",-1)),f("div",Ue,d(a(n).type.replace("_"," ")),1)]),_:1}),e(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[8]||(l[8]=f("div",{class:"text-caption text-medium-emphasis"},"Scheduled For",-1)),f("div",{class:be(["text-body-1",{"text-error":a(re)}])},d(fe(a(n).scheduledFor)),3)]),_:1}),e(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[9]||(l[9]=f("div",{class:"text-caption text-medium-emphasis"},"Created",-1)),f("div",Ee,d(me(a(n).createdAt)),1)]),_:1}),e(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[10]||(l[10]=f("div",{class:"text-caption text-medium-emphasis"},"Quick Actions",-1)),e(Pe,{density:"compact",class:"mt-1"},{default:t(()=>[(i(),C(R,null,Y(se,r=>e(p,{key:r.value,color:a(n).status===r.value?r.color:void 0,variant:a(n).status===r.value?"flat":"outlined",size:"small",onClick:q=>ce(r.value)},{default:t(()=>[o(d(r.title),1)]),_:2},1032,["color","variant","onClick"])),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(y,{cols:"12",md:"6"},{default:t(()=>[e(_,{class:"h-100"},{default:t(()=>[e(w,null,{default:t(()=>[e(u,{icon:"mdi-grave-stone",class:"mr-2"}),l[11]||(l[11]=o(" Grave Information ",-1))]),_:1}),e(k,null,{default:t(()=>[e(H,null,{default:t(()=>[e(S,null,{prepend:t(()=>[e(u,{icon:"mdi-map-marker"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).cemeteryName),1)]),_:1}),e(b,null,{default:t(()=>[...l[12]||(l[12]=[o("Cemetery",-1)])]),_:1})]),_:1}),e(S,null,{prepend:t(()=>[e(u,{icon:"mdi-grid"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).plotRef),1)]),_:1}),e(b,null,{default:t(()=>[...l[13]||(l[13]=[o("Plot Reference",-1)])]),_:1})]),_:1}),e(S,null,{prepend:t(()=>[e(u,{icon:"mdi-account"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).deceasedName||"Unknown"),1)]),_:1}),e(b,null,{default:t(()=>[...l[14]||(l[14]=[o("Deceased",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(p,{variant:"text",to:`/graves/${a(n).graveId}`},{default:t(()=>[l[15]||(l[15]=o(" View Grave Details ",-1)),e(u,{icon:"mdi-arrow-right",end:""})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),e(y,{cols:"12",md:"6"},{default:t(()=>[e(_,{class:"h-100"},{default:t(()=>[e(w,null,{default:t(()=>[e(u,{icon:"mdi-account-circle",class:"mr-2"}),l[16]||(l[16]=o(" Customer Information ",-1))]),_:1}),e(k,null,{default:t(()=>[e(H,null,{default:t(()=>[e(S,null,{prepend:t(()=>[e(u,{icon:"mdi-account"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).customerName||"Unknown"),1)]),_:1}),e(b,null,{default:t(()=>[...l[17]||(l[17]=[o("Name",-1)])]),_:1})]),_:1}),a(n).customerPhone?(i(),m(S,{key:0},{prepend:t(()=>[e(u,{icon:"mdi-phone"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).customerPhone),1)]),_:1}),e(b,null,{default:t(()=>[...l[18]||(l[18]=[o("Phone",-1)])]),_:1})]),_:1})):V("",!0),a(n).customerEmail?(i(),m(S,{key:1},{prepend:t(()=>[e(u,{icon:"mdi-email"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).customerEmail),1)]),_:1}),e(b,null,{default:t(()=>[...l[19]||(l[19]=[o("Email",-1)])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(p,{variant:"text",onClick:l[0]||(l[0]=r=>a(ne)?.())},{default:t(()=>[e(u,{icon:"mdi-email-send",start:""}),l[20]||(l[20]=o(" Send Report ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(n).notes?(i(),m(_,{key:0,class:"mt-4"},{default:t(()=>[e(w,null,{default:t(()=>[e(u,{icon:"mdi-note-text",class:"mr-2"}),l[21]||(l[21]=o(" Notes ",-1))]),_:1}),e(k,null,{default:t(()=>[f("p",Fe,d(a(n).notes),1)]),_:1})]),_:1})):V("",!0),e(_,{class:"mt-4"},{default:t(()=>[e(w,{class:"d-flex align-center"},{default:t(()=>[e(u,{icon:"mdi-camera",class:"mr-2"}),l[23]||(l[23]=o(" Photo Report ",-1)),e(I),e(p,{color:"primary",size:"small",onClick:ve},{default:t(()=>[e(u,{icon:"mdi-upload",start:""}),l[22]||(l[22]=o(" Upload Photo ",-1))]),_:1}),f("input",{ref_key:"fileInput",ref:J,type:"file",accept:"image/*",style:{display:"none"},onChange:_e},null,544)]),_:1}),e(k,null,{default:t(()=>[a(oe)?(i(),C("div",Ne,[e(Te,{indeterminate:""})])):a(G)?.length?(i(),m(B,{key:1},{default:t(()=>[(i(!0),C(R,null,Y(a(G),r=>(i(),m(y,{key:r.id,cols:"6",sm:"4",md:"3"},{default:t(()=>[e(_,{variant:"outlined"},{default:t(()=>[e(ee,{src:r.blobUrl,"aspect-ratio":"1",cover:"",class:"cursor-pointer",onClick:q=>ye(r)},{placeholder:t(()=>[e(te,{type:"image"})]),_:1},8,["src","onClick"]),r.caption?(i(),m(k,{key:0,class:"pa-2 text-caption"},{default:t(()=>[o(d(r.caption),1)]),_:2},1024)):V("",!0),e(h,{class:"pa-2"},{default:t(()=>[e(I),e(p,{icon:"",size:"x-small",color:"error",variant:"text",onClick:q=>ge(r.id)},{default:t(()=>[e(u,{icon:"mdi-delete"})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(i(),C("div",ze,[e(u,{icon:"mdi-camera-off",size:"48",class:"mb-2"}),l[24]||(l[24]=f("div",null,"No photos uploaded yet",-1))]))]),_:1})]),_:1})],64)):(i(),m(De,{key:2,type:"error",variant:"tonal"},{default:t(()=>[...l[25]||(l[25]=[o(" Task not found ",-1)])]),_:1})),e(z,{modelValue:a(F),"onUpdate:modelValue":l[1]||(l[1]=r=>A(F)?F.value=r:null),task:a(n),onSaved:a(O)},null,8,["modelValue","task","onSaved"]),e(Q,{modelValue:a(P),"onUpdate:modelValue":l[3]||(l[3]=r=>A(P)?P.value=r:null),"max-width":"800"},{default:t(()=>[a($)?(i(),m(_,{key:0},{default:t(()=>[e(ee,{src:a($).blobUrl,"max-height":"600"},null,8,["src"]),a($).caption?(i(),m(k,{key:0},{default:t(()=>[o(d(a($).caption),1)]),_:1})):V("",!0),e(h,null,{default:t(()=>[e(I),e(p,{variant:"text",onClick:l[2]||(l[2]=r=>P.value=!1)},{default:t(()=>[...l[26]||(l[26]=[o("Close",-1)])]),_:1})]),_:1})]),_:1})):V("",!0)]),_:1},8,["modelValue"]),e(Q,{modelValue:a(T),"onUpdate:modelValue":l[5]||(l[5]=r=>A(T)?T.value=r:null),"max-width":"400",persistent:""},{default:t(()=>[e(_,null,{default:t(()=>[e(w,null,{default:t(()=>[...l[27]||(l[27]=[o("Add Caption (Optional)",-1)])]),_:1}),e(k,null,{default:t(()=>[e($e,{modelValue:a(g),"onUpdate:modelValue":l[4]||(l[4]=r=>A(g)?g.value=r:null),label:"Caption",rows:"2","hide-details":""},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(I),e(p,{variant:"text",onClick:K},{default:t(()=>[...l[28]||(l[28]=[o("Cancel",-1)])]),_:1}),e(p,{color:"primary",loading:a(L),onClick:ke},{default:t(()=>[...l[29]||(l[29]=[o(" Upload ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Je=Ie(Ae,[["__scopeId","data-v-a163f8ef"]]);export{Je as default};
