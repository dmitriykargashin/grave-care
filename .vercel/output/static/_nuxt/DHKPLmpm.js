import{d as D,ag as I,ah as E,r as V,k as C,ao as G,ai as F,W as N,C as r,af as $,y as B,B as l,aj as M,D as m,M as L,_ as a,A as p,ak as O,al as j,am as K,az as z,a6 as H,aA as Q,aB as Y,a9 as J,Y as h,V as x,I as c,au as y,ad as W,an as X,$ as Z,J as P,P as ee,G as le}from"./CqnZqnHT.js";import{u as te}from"./CPSzfpNf.js";const ae=[{value:"cleanup",title:"Cleanup"},{value:"flowers",title:"Flowers"},{value:"headstone",title:"Headstone"},{value:"photo_report",title:"Photo Report"},{value:"other",title:"Other"}],oe=[{value:"todo",title:"To Do",color:"grey"},{value:"scheduled",title:"Scheduled",color:"blue"},{value:"in_progress",title:"In Progress",color:"orange"},{value:"done",title:"Done",color:"success"},{value:"canceled",title:"Canceled",color:"error"}],se=[{value:"low",title:"Low",color:"grey"},{value:"normal",title:"Normal",color:"blue"},{value:"high",title:"High",color:"error"}],re=D({__name:"TaskDialog",props:I({task:{},prefillGraveId:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:I(["saved"],["update:modelValue"]),async setup(g,{emit:U}){let d,T;const u=g,q=U,n=E(g,"modelValue"),k=V(),v=V(!1),i=C(()=>!!u.task?.id),o=V({graveId:"",title:"",type:"cleanup",status:"todo",priority:"normal",scheduledFor:"",notes:""}),{data:A}=([d,T]=G(()=>te("/api/graves","$LxaLQQEVap")),d=await d,T(),d),R=C(()=>(A.value||[]).map(s=>({id:s.id,label:`${s.deceasedName||"Unknown"} - ${s.plotRef}`,cemetery:s.cemeteryName||"",plot:s.plotRef}))),S=le("showSnackbar");F(()=>u.task,s=>{s?o.value={graveId:s.graveId,title:s.title,type:s.type,status:s.status,priority:s.priority,scheduledFor:s.scheduledFor?.split("T")[0]||"",notes:s.notes||""}:_()},{immediate:!0}),F(()=>n.value,s=>{s&&!u.task&&u.prefillGraveId&&(o.value.graveId=u.prefillGraveId)});function _(){o.value={graveId:u.prefillGraveId||"",title:"",type:"cleanup",status:"todo",priority:"normal",scheduledFor:"",notes:""}}function w(){n.value=!1,_()}async function b(){const{valid:s}=await k.value.validate();if(s){v.value=!0;try{const t=i.value?`/api/tasks/${u.task.id}`:"/api/tasks",e=i.value?"PUT":"POST",f=await $fetch(t,{method:e,body:{...o.value,scheduledFor:o.value.scheduledFor||null}});q("saved",f),S?.(`Task ${i.value?"updated":"created"} successfully`),w()}catch(t){console.error("Error saving task:",t),S?.("Failed to save task","error")}finally{v.value=!1}}}return(s,t)=>(B(),N($,{modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=e=>n.value=e),"max-width":"600",persistent:""},{default:r(()=>[l(ee,null,{default:r(()=>[l(M,{class:"d-flex align-center"},{default:r(()=>[l(L,{icon:a(i)?"mdi-pencil":"mdi-plus",class:"mr-2"},null,8,["icon"]),m(" "+p(a(i)?"Edit Task":"New Task"),1)]),_:1}),l(O,null,{default:r(()=>[l(j,{ref_key:"formRef",ref:k,onSubmit:K(b,["prevent"])},{default:r(()=>[l(z,{modelValue:a(o).graveId,"onUpdate:modelValue":t[0]||(t[0]=e=>a(o).graveId=e),items:a(R),"item-title":"label","item-value":"id",label:"Grave",rules:[e=>!!e||"Grave is required"],required:""},{item:r(({item:e,props:f})=>[l(H,Q(Y(f)),{default:r(()=>[l(J,null,{default:r(()=>[m(p(e.raw.cemetery)+" Â· "+p(e.raw.plot),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","rules"]),l(h,{modelValue:a(o).title,"onUpdate:modelValue":t[1]||(t[1]=e=>a(o).title=e),label:"Title",rules:[e=>!!e||"Title is required"],required:""},null,8,["modelValue","rules"]),l(x,null,{default:r(()=>[l(c,{cols:"12",sm:"6"},{default:r(()=>[l(y,{modelValue:a(o).type,"onUpdate:modelValue":t[2]||(t[2]=e=>a(o).type=e),items:a(ae),"item-title":"title","item-value":"value",label:"Type",rules:[e=>!!e||"Type is required"],required:""},null,8,["modelValue","items","rules"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:r(()=>[l(y,{modelValue:a(o).priority,"onUpdate:modelValue":t[3]||(t[3]=e=>a(o).priority=e),items:a(se),"item-title":"title","item-value":"value",label:"Priority",rules:[e=>!!e||"Priority is required"],required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),l(x,null,{default:r(()=>[l(c,{cols:"12",sm:"6"},{default:r(()=>[l(y,{modelValue:a(o).status,"onUpdate:modelValue":t[4]||(t[4]=e=>a(o).status=e),items:a(oe),"item-title":"title","item-value":"value",label:"Status",rules:[e=>!!e||"Status is required"],required:""},null,8,["modelValue","items","rules"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:r(()=>[l(h,{modelValue:a(o).scheduledFor,"onUpdate:modelValue":t[5]||(t[5]=e=>a(o).scheduledFor=e),label:"Scheduled For",type:"date"},null,8,["modelValue"])]),_:1})]),_:1}),l(W,{modelValue:a(o).notes,"onUpdate:modelValue":t[6]||(t[6]=e=>a(o).notes=e),label:"Notes",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),l(X,null,{default:r(()=>[l(Z),l(P,{variant:"text",onClick:w},{default:r(()=>[...t[8]||(t[8]=[m("Cancel",-1)])]),_:1}),l(P,{color:"primary",loading:a(v),onClick:b},{default:r(()=>[m(p(a(i)?"Save":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),de=Object.assign(re,{__name:"TaskDialog"});export{oe as T,de as _,se as a,ae as b};
