import{d as G,a0 as w,a1 as M,r as f,k as A,I as x,a2 as N,N as B,C as i,a3 as P,y as $,B as s,P as E,D as p,M as j,J as l,A as b,K as O,a4 as Z,Y as z,Z as J,_,V as K,G as Q}from"./DSoo6jVJ.js";import{u as R,b as Y,c as k,d as H}from"./BxkK-uK3.js";import{V as S}from"./CDhTuRGa.js";const L=G({__name:"GraveDialog",props:w({grave:{},prefillCemeteryId:{},prefillCustomerId:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:w(["saved"],["update:modelValue"]),async setup(V,{emit:q}){let d,m;const o=V,T=q,n=M(V,"modelValue"),v=f(),c=f(!1),u=A(()=>!!o.grave?.id),t=f({cemeteryId:"",customerId:"",plotRef:"",deceasedName:"",specialInstructions:""}),{data:U}=([d,m]=x(()=>R("/api/cemeteries","$EowNjxQ9F_")),d=await d,m(),d),{data:D}=([d,m]=x(()=>R("/api/customers","$m9ryzeAZqV")),d=await d,m(),d),I=Q("showSnackbar");N(()=>o.grave,r=>{r?t.value={cemeteryId:r.cemeteryId,customerId:r.customerId,plotRef:r.plotRef,deceasedName:r.deceasedName||"",specialInstructions:r.specialInstructions||""}:y()},{immediate:!0}),N(()=>n.value,r=>{r&&!o.grave&&(o.prefillCemeteryId&&(t.value.cemeteryId=o.prefillCemeteryId),o.prefillCustomerId&&(t.value.customerId=o.prefillCustomerId))});function y(){t.value={cemeteryId:o.prefillCemeteryId||"",customerId:o.prefillCustomerId||"",plotRef:"",deceasedName:"",specialInstructions:""}}function C(){n.value=!1,y()}async function g(){const{valid:r}=await v.value.validate();if(r){c.value=!0;try{const a=u.value?`/api/graves/${o.grave.id}`:"/api/graves",e=u.value?"PUT":"POST",F=await $fetch(a,{method:e,body:t.value});T("saved",F),I?.(`Grave ${u.value?"updated":"created"} successfully`),C()}catch(a){console.error("Error saving grave:",a),I?.("Failed to save grave","error")}finally{c.value=!1}}}return(r,a)=>($(),B(P,{modelValue:n.value,"onUpdate:modelValue":a[5]||(a[5]=e=>n.value=e),"max-width":"600",persistent:""},{default:i(()=>[s(K,null,{default:i(()=>[s(E,{class:"d-flex align-center"},{default:i(()=>[s(j,{icon:l(u)?"mdi-pencil":"mdi-plus",class:"mr-2"},null,8,["icon"]),p(" "+b(l(u)?"Edit Grave":"New Grave"),1)]),_:1}),s(O,null,{default:i(()=>[s(Y,{ref_key:"formRef",ref:v,onSubmit:Z(g,["prevent"])},{default:i(()=>[s(S,{modelValue:l(t).cemeteryId,"onUpdate:modelValue":a[0]||(a[0]=e=>l(t).cemeteryId=e),items:l(U),"item-title":"name","item-value":"id",label:"Cemetery",rules:[e=>!!e||"Cemetery is required"],required:""},null,8,["modelValue","items","rules"]),s(S,{modelValue:l(t).customerId,"onUpdate:modelValue":a[1]||(a[1]=e=>l(t).customerId=e),items:l(D),"item-title":"fullName","item-value":"id",label:"Customer",rules:[e=>!!e||"Customer is required"],required:""},null,8,["modelValue","items","rules"]),s(k,{modelValue:l(t).plotRef,"onUpdate:modelValue":a[2]||(a[2]=e=>l(t).plotRef=e),label:"Plot Reference",rules:[e=>!!e||"Plot reference is required"],required:""},null,8,["modelValue","rules"]),s(k,{modelValue:l(t).deceasedName,"onUpdate:modelValue":a[3]||(a[3]=e=>l(t).deceasedName=e),label:"Deceased Name"},null,8,["modelValue"]),s(H,{modelValue:l(t).specialInstructions,"onUpdate:modelValue":a[4]||(a[4]=e=>l(t).specialInstructions=e),label:"Special Instructions",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),s(z,null,{default:i(()=>[s(J),s(_,{variant:"text",onClick:C},{default:i(()=>[...a[6]||(a[6]=[p("Cancel",-1)])]),_:1}),s(_,{color:"primary",loading:l(c),onClick:g},{default:i(()=>[p(b(l(u)?"Save":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ee=Object.assign(L,{__name:"GraveDialog"});export{ee as _};
