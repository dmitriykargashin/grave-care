import{d as N,a0 as I,a1 as D,r as V,k as C,I as E,a2 as F,N as G,C as r,a3 as M,y as $,B as l,P as B,D as m,M as L,J as a,A as p,K as O,a4 as K,T as j,ac as H,ad as Q,W as Y,Y as z,Z as J,_ as h,V as W,G as Z}from"./DSoo6jVJ.js";import{u as X,b as ee,c as x,a as P,V as c,d as le}from"./BxkK-uK3.js";import{V as te}from"./CDhTuRGa.js";import{V as y}from"./D9WYUSSA.js";const ae=[{value:"cleanup",title:"Cleanup"},{value:"flowers",title:"Flowers"},{value:"headstone",title:"Headstone"},{value:"photo_report",title:"Photo Report"},{value:"other",title:"Other"}],oe=[{value:"todo",title:"To Do",color:"grey"},{value:"scheduled",title:"Scheduled",color:"blue"},{value:"in_progress",title:"In Progress",color:"orange"},{value:"done",title:"Done",color:"success"},{value:"canceled",title:"Canceled",color:"error"}],se=[{value:"low",title:"Low",color:"grey"},{value:"normal",title:"Normal",color:"blue"},{value:"high",title:"High",color:"error"}],re=N({__name:"TaskDialog",props:I({task:{},prefillGraveId:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:I(["saved"],["update:modelValue"]),async setup(T,{emit:U}){let d,g;const u=T,q=U,n=D(T,"modelValue"),k=V(),f=V(!1),i=C(()=>!!u.task?.id),o=V({graveId:"",title:"",type:"cleanup",status:"todo",priority:"normal",scheduledFor:"",notes:""}),{data:R}=([d,g]=E(()=>X("/api/graves","$LxaLQQEVap")),d=await d,g(),d),A=C(()=>(R.value||[]).map(s=>({id:s.id,label:`${s.deceasedName||"Unknown"} - ${s.plotRef}`,cemetery:s.cemeteryName||"",plot:s.plotRef}))),S=Z("showSnackbar");F(()=>u.task,s=>{s?o.value={graveId:s.graveId,title:s.title,type:s.type,status:s.status,priority:s.priority,scheduledFor:s.scheduledFor?.split("T")[0]||"",notes:s.notes||""}:_()},{immediate:!0}),F(()=>n.value,s=>{s&&!u.task&&u.prefillGraveId&&(o.value.graveId=u.prefillGraveId)});function _(){o.value={graveId:u.prefillGraveId||"",title:"",type:"cleanup",status:"todo",priority:"normal",scheduledFor:"",notes:""}}function b(){n.value=!1,_()}async function w(){const{valid:s}=await k.value.validate();if(s){f.value=!0;try{const t=i.value?`/api/tasks/${u.task.id}`:"/api/tasks",e=i.value?"PUT":"POST",v=await $fetch(t,{method:e,body:{...o.value,scheduledFor:o.value.scheduledFor||null}});q("saved",v),S?.(`Task ${i.value?"updated":"created"} successfully`),b()}catch(t){console.error("Error saving task:",t),S?.("Failed to save task","error")}finally{f.value=!1}}}return(s,t)=>($(),G(M,{modelValue:n.value,"onUpdate:modelValue":t[7]||(t[7]=e=>n.value=e),"max-width":"600",persistent:""},{default:r(()=>[l(W,null,{default:r(()=>[l(B,{class:"d-flex align-center"},{default:r(()=>[l(L,{icon:a(i)?"mdi-pencil":"mdi-plus",class:"mr-2"},null,8,["icon"]),m(" "+p(a(i)?"Edit Task":"New Task"),1)]),_:1}),l(O,null,{default:r(()=>[l(ee,{ref_key:"formRef",ref:k,onSubmit:K(w,["prevent"])},{default:r(()=>[l(te,{modelValue:a(o).graveId,"onUpdate:modelValue":t[0]||(t[0]=e=>a(o).graveId=e),items:a(A),"item-title":"label","item-value":"id",label:"Grave",rules:[e=>!!e||"Grave is required"],required:""},{item:r(({item:e,props:v})=>[l(j,H(Q(v)),{default:r(()=>[l(Y,null,{default:r(()=>[m(p(e.raw.cemetery)+" Â· "+p(e.raw.plot),1)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","items","rules"]),l(x,{modelValue:a(o).title,"onUpdate:modelValue":t[1]||(t[1]=e=>a(o).title=e),label:"Title",rules:[e=>!!e||"Title is required"],required:""},null,8,["modelValue","rules"]),l(P,null,{default:r(()=>[l(c,{cols:"12",sm:"6"},{default:r(()=>[l(y,{modelValue:a(o).type,"onUpdate:modelValue":t[2]||(t[2]=e=>a(o).type=e),items:a(ae),"item-title":"title","item-value":"value",label:"Type",rules:[e=>!!e||"Type is required"],required:""},null,8,["modelValue","items","rules"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:r(()=>[l(y,{modelValue:a(o).priority,"onUpdate:modelValue":t[3]||(t[3]=e=>a(o).priority=e),items:a(se),"item-title":"title","item-value":"value",label:"Priority",rules:[e=>!!e||"Priority is required"],required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),l(P,null,{default:r(()=>[l(c,{cols:"12",sm:"6"},{default:r(()=>[l(y,{modelValue:a(o).status,"onUpdate:modelValue":t[4]||(t[4]=e=>a(o).status=e),items:a(oe),"item-title":"title","item-value":"value",label:"Status",rules:[e=>!!e||"Status is required"],required:""},null,8,["modelValue","items","rules"])]),_:1}),l(c,{cols:"12",sm:"6"},{default:r(()=>[l(x,{modelValue:a(o).scheduledFor,"onUpdate:modelValue":t[5]||(t[5]=e=>a(o).scheduledFor=e),label:"Scheduled For",type:"date"},null,8,["modelValue"])]),_:1})]),_:1}),l(le,{modelValue:a(o).notes,"onUpdate:modelValue":t[6]||(t[6]=e=>a(o).notes=e),label:"Notes",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),l(z,null,{default:r(()=>[l(J),l(h,{variant:"text",onClick:b},{default:r(()=>[...t[8]||(t[8]=[m("Cancel",-1)])]),_:1}),l(h,{color:"primary",loading:a(f),onClick:w},{default:r(()=>[m(p(a(i)?"Save":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),me=Object.assign(re,{__name:"TaskDialog"});export{oe as T,me as _,se as a,ae as b};
