import{_ as xe,T as Y,a as Ve}from"./TP-IniU1.js";import{d as Ce,a5 as Se,I as Z,r as v,k as we,x as V,B as e,N as m,C as t,_ as p,J as a,R as L,O as C,V as _,$ as z,a3 as q,G as M,y as i,D as o,M as u,P as S,z as f,A as d,Z as I,X as W,K as y,a6 as De,a7 as Te,S as X,Q as H,T as w,U as D,W as T,Y as h,a8 as be,a9 as ee}from"./DSoo6jVJ.js";import{a as B,u as te,V as k,d as Pe}from"./BxkK-uK3.js";import{V as $e}from"./CJj81yv5.js";import{V as le}from"./BNw2KUzE.js";import{_ as Ie}from"./DlAUqK2U.js";import"./CDhTuRGa.js";import"./D9WYUSSA.js";const he={class:"text-h5"},Ue={class:"text-body-1 text-capitalize"},Ee={class:"text-body-1"},Fe={class:"text-body-1",style:{"white-space":"pre-wrap"}},Ne={key:0,class:"text-center py-4"},Re={key:2,class:"text-center text-medium-emphasis py-8"},ze=Ce({__name:"[id]",async setup(Ae){let c,U;const E=Se().params.id,{data:n,pending:ae,refresh:O}=([c,U]=Z(()=>te(`/api/tasks/${E}`,"$2DSv-3zRoY")),c=await c,U(),c),{data:G,pending:oe,refresh:J}=([c,U]=Z(()=>te(`/api/tasks/${E}/photos`,"$8ZJymoJw1j")),c=await c,U(),c),F=v(!1),b=v(!1),P=v(!1),$=v(null),K=v(),N=v(null),g=v(""),A=v(!1),x=M("showSnackbar"),ne=M("showComingSoon"),se=[{value:"in_progress",title:"Start",color:"orange"},{value:"done",title:"Complete",color:"success"},{value:"canceled",title:"Cancel",color:"error"}],re=we(()=>!n.value?.scheduledFor||n.value.status==="done"||n.value.status==="canceled"?!1:new Date(n.value.scheduledFor)<new Date(new Date().toDateString()));function ue(s){return Y.find(l=>l.value===s)?.color||"grey"}function ie(s){return Y.find(l=>l.value===s)?.title||s}function de(s){return Ve.find(l=>l.value===s)?.color||"grey"}function fe(s){return s?new Date(s).toLocaleDateString():"Not scheduled"}function me(s){return new Date(s).toLocaleString()}function pe(){F.value=!0}async function ce(s){try{await $fetch(`/api/tasks/${E}/status`,{method:"POST",body:{status:s}}),x?.("Status updated"),O()}catch(l){console.error("Error updating status:",l),x?.("Failed to update status","error")}}function ve(){K.value?.click()}function _e(s){const l=s.target,R=l.files?.[0];R&&(N.value=R,g.value="",P.value=!0,l.value="")}function j(){N.value=null,g.value="",P.value=!1}async function ye(){if(N.value){A.value=!0;try{const s=new FormData;s.append("file",N.value);const{blobUrl:l}=await $fetch("/api/photos/upload",{method:"POST",body:s});await $fetch(`/api/tasks/${E}/photos`,{method:"POST",body:{blobUrl:l,caption:g.value||null}}),x?.("Photo uploaded successfully"),J(),j()}catch(s){console.error("Error uploading photo:",s),x?.("Failed to upload photo","error")}finally{A.value=!1}}}function ke(s){$.value=s,b.value=!0}async function ge(s){if(confirm("Delete this photo?"))try{await $fetch(`/api/task-photos/${s}`,{method:"DELETE"}),x?.("Photo deleted"),J()}catch(l){console.error("Error deleting photo:",l),x?.("Failed to delete photo","error")}}return(s,l)=>{const R=xe;return i(),V("div",null,[e(p,{variant:"text",class:"mb-4",to:"/tasks"},{default:t(()=>[e(u,{icon:"mdi-arrow-left",start:""}),l[6]||(l[6]=o(" Back to Tasks ",-1))]),_:1}),a(ae)?(i(),m(le,{key:0,type:"article"})):a(n)?(i(),V(L,{key:1},[e(_,{class:"mb-4"},{default:t(()=>[e(S,{class:"d-flex align-center flex-wrap ga-2"},{default:t(()=>[f("span",he,d(a(n).title),1),e(I),e(W,{color:ue(a(n).status),size:"small"},{default:t(()=>[o(d(ie(a(n).status)),1)]),_:1},8,["color"]),e(W,{color:de(a(n).priority),size:"small",variant:"outlined"},{default:t(()=>[o(d(a(n).priority),1)]),_:1},8,["color"]),e(p,{icon:"",variant:"text",onClick:pe},{default:t(()=>[e(u,{icon:"mdi-pencil"})]),_:1})]),_:1}),e(y,null,{default:t(()=>[e(B,null,{default:t(()=>[e(k,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[7]||(l[7]=f("div",{class:"text-caption text-medium-emphasis"},"Type",-1)),f("div",Ue,d(a(n).type.replace("_"," ")),1)]),_:1}),e(k,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[8]||(l[8]=f("div",{class:"text-caption text-medium-emphasis"},"Scheduled For",-1)),f("div",{class:De(["text-body-1",{"text-error":a(re)}])},d(fe(a(n).scheduledFor)),3)]),_:1}),e(k,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[9]||(l[9]=f("div",{class:"text-caption text-medium-emphasis"},"Created",-1)),f("div",Ee,d(me(a(n).createdAt)),1)]),_:1}),e(k,{cols:"12",sm:"6",md:"3"},{default:t(()=>[l[10]||(l[10]=f("div",{class:"text-caption text-medium-emphasis"},"Quick Actions",-1)),e(Te,{density:"compact",class:"mt-1"},{default:t(()=>[(i(),V(L,null,X(se,r=>e(p,{key:r.value,color:a(n).status===r.value?r.color:void 0,variant:a(n).status===r.value?"flat":"outlined",size:"small",onClick:Q=>ce(r.value)},{default:t(()=>[o(d(r.title),1)]),_:2},1032,["color","variant","onClick"])),64))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(B,null,{default:t(()=>[e(k,{cols:"12",md:"6"},{default:t(()=>[e(_,{class:"h-100"},{default:t(()=>[e(S,null,{default:t(()=>[e(u,{icon:"mdi-grave-stone",class:"mr-2"}),l[11]||(l[11]=o(" Grave Information ",-1))]),_:1}),e(y,null,{default:t(()=>[e(H,null,{default:t(()=>[e(w,null,{prepend:t(()=>[e(u,{icon:"mdi-map-marker"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).cemeteryName),1)]),_:1}),e(T,null,{default:t(()=>[...l[12]||(l[12]=[o("Cemetery",-1)])]),_:1})]),_:1}),e(w,null,{prepend:t(()=>[e(u,{icon:"mdi-grid"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).plotRef),1)]),_:1}),e(T,null,{default:t(()=>[...l[13]||(l[13]=[o("Plot Reference",-1)])]),_:1})]),_:1}),e(w,null,{prepend:t(()=>[e(u,{icon:"mdi-account"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).deceasedName||"Unknown"),1)]),_:1}),e(T,null,{default:t(()=>[...l[14]||(l[14]=[o("Deceased",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(p,{variant:"text",to:`/graves/${a(n).graveId}`},{default:t(()=>[l[15]||(l[15]=o(" View Grave Details ",-1)),e(u,{icon:"mdi-arrow-right",end:""})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),e(k,{cols:"12",md:"6"},{default:t(()=>[e(_,{class:"h-100"},{default:t(()=>[e(S,null,{default:t(()=>[e(u,{icon:"mdi-account-circle",class:"mr-2"}),l[16]||(l[16]=o(" Customer Information ",-1))]),_:1}),e(y,null,{default:t(()=>[e(H,null,{default:t(()=>[e(w,null,{prepend:t(()=>[e(u,{icon:"mdi-account"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).customerName||"Unknown"),1)]),_:1}),e(T,null,{default:t(()=>[...l[17]||(l[17]=[o("Name",-1)])]),_:1})]),_:1}),a(n).customerPhone?(i(),m(w,{key:0},{prepend:t(()=>[e(u,{icon:"mdi-phone"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).customerPhone),1)]),_:1}),e(T,null,{default:t(()=>[...l[18]||(l[18]=[o("Phone",-1)])]),_:1})]),_:1})):C("",!0),a(n).customerEmail?(i(),m(w,{key:1},{prepend:t(()=>[e(u,{icon:"mdi-email"})]),default:t(()=>[e(D,null,{default:t(()=>[o(d(a(n).customerEmail),1)]),_:1}),e(T,null,{default:t(()=>[...l[19]||(l[19]=[o("Email",-1)])]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(p,{variant:"text",onClick:l[0]||(l[0]=r=>a(ne)?.())},{default:t(()=>[e(u,{icon:"mdi-email-send",start:""}),l[20]||(l[20]=o(" Send Report ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(n).notes?(i(),m(_,{key:0,class:"mt-4"},{default:t(()=>[e(S,null,{default:t(()=>[e(u,{icon:"mdi-note-text",class:"mr-2"}),l[21]||(l[21]=o(" Notes ",-1))]),_:1}),e(y,null,{default:t(()=>[f("p",Fe,d(a(n).notes),1)]),_:1})]),_:1})):C("",!0),e(_,{class:"mt-4"},{default:t(()=>[e(S,{class:"d-flex align-center"},{default:t(()=>[e(u,{icon:"mdi-camera",class:"mr-2"}),l[23]||(l[23]=o(" Photo Report ",-1)),e(I),e(p,{color:"primary",size:"small",onClick:ve},{default:t(()=>[e(u,{icon:"mdi-upload",start:""}),l[22]||(l[22]=o(" Upload Photo ",-1))]),_:1}),f("input",{ref_key:"fileInput",ref:K,type:"file",accept:"image/*",style:{display:"none"},onChange:_e},null,544)]),_:1}),e(y,null,{default:t(()=>[a(oe)?(i(),V("div",Ne,[e(be,{indeterminate:""})])):a(G)?.length?(i(),m(B,{key:1},{default:t(()=>[(i(!0),V(L,null,X(a(G),r=>(i(),m(k,{key:r.id,cols:"6",sm:"4",md:"3"},{default:t(()=>[e(_,{variant:"outlined"},{default:t(()=>[e(ee,{src:r.blobUrl,"aspect-ratio":"1",cover:"",class:"cursor-pointer",onClick:Q=>ke(r)},{placeholder:t(()=>[e(le,{type:"image"})]),_:1},8,["src","onClick"]),r.caption?(i(),m(y,{key:0,class:"pa-2 text-caption"},{default:t(()=>[o(d(r.caption),1)]),_:2},1024)):C("",!0),e(h,{class:"pa-2"},{default:t(()=>[e(I),e(p,{icon:"",size:"x-small",color:"error",variant:"text",onClick:Q=>ge(r.id)},{default:t(()=>[e(u,{icon:"mdi-delete"})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(i(),V("div",Re,[e(u,{icon:"mdi-camera-off",size:"48",class:"mb-2"}),l[24]||(l[24]=f("div",null,"No photos uploaded yet",-1))]))]),_:1})]),_:1})],64)):(i(),m($e,{key:2,type:"error",variant:"tonal"},{default:t(()=>[...l[25]||(l[25]=[o(" Task not found ",-1)])]),_:1})),e(R,{modelValue:a(F),"onUpdate:modelValue":l[1]||(l[1]=r=>z(F)?F.value=r:null),task:a(n),onSaved:a(O)},null,8,["modelValue","task","onSaved"]),e(q,{modelValue:a(b),"onUpdate:modelValue":l[3]||(l[3]=r=>z(b)?b.value=r:null),"max-width":"800"},{default:t(()=>[a($)?(i(),m(_,{key:0},{default:t(()=>[e(ee,{src:a($).blobUrl,"max-height":"600"},null,8,["src"]),a($).caption?(i(),m(y,{key:0},{default:t(()=>[o(d(a($).caption),1)]),_:1})):C("",!0),e(h,null,{default:t(()=>[e(I),e(p,{variant:"text",onClick:l[2]||(l[2]=r=>b.value=!1)},{default:t(()=>[...l[26]||(l[26]=[o("Close",-1)])]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1},8,["modelValue"]),e(q,{modelValue:a(P),"onUpdate:modelValue":l[5]||(l[5]=r=>z(P)?P.value=r:null),"max-width":"400",persistent:""},{default:t(()=>[e(_,null,{default:t(()=>[e(S,null,{default:t(()=>[...l[27]||(l[27]=[o("Add Caption (Optional)",-1)])]),_:1}),e(y,null,{default:t(()=>[e(Pe,{modelValue:a(g),"onUpdate:modelValue":l[4]||(l[4]=r=>z(g)?g.value=r:null),label:"Caption",rows:"2","hide-details":""},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(I),e(p,{variant:"text",onClick:j},{default:t(()=>[...l[28]||(l[28]=[o("Cancel",-1)])]),_:1}),e(p,{color:"primary",loading:a(A),onClick:ye},{default:t(()=>[...l[29]||(l[29]=[o(" Upload ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}}),Ze=Ie(ze,[["__scopeId","data-v-a163f8ef"]]);export{Ze as default};
