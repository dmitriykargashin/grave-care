import{d as U,ag as F,ah as G,r as v,k as Q,ai as W,W as _,C as a,af as z,y as f,B as e,aj as R,D as i,M as y,_ as l,A as E,ak as S,al as X,am as Y,Y as Z,ad as H,an as j,$ as O,J as p,P as N,G as P,ao as K,x as L,Z as M,V as h,I,z as $,ap as ee,a5 as ae,N as te,O as le,a6 as oe,X as se,a7 as re,a9 as ne,Q as de}from"./CqnZqnHT.js";import{u as ie}from"./CPSzfpNf.js";const ue=U({__name:"CemeteryDialog",props:F({cemetery:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:F(["saved"],["update:modelValue"]),setup(A,{emit:C}){const g=A,T=C,x=G(A,"modelValue"),w=v(),u=v(!1),s=Q(()=>!!g.cemetery?.id),r=v({name:"",address:""}),V=P("showSnackbar");W(()=>g.cemetery,m=>{m?r.value={name:m.name,address:m.address||""}:k()},{immediate:!0});function k(){r.value={name:"",address:""}}function b(){x.value=!1,k()}async function D(){const{valid:m}=await w.value.validate();if(m){u.value=!0;try{const o=s.value?`/api/cemeteries/${g.cemetery.id}`:"/api/cemeteries",n=s.value?"PUT":"POST",B=await $fetch(o,{method:n,body:r.value});T("saved",B),V?.(`Cemetery ${s.value?"updated":"created"} successfully`),b()}catch(o){console.error("Error saving cemetery:",o),V?.("Failed to save cemetery","error")}finally{u.value=!1}}}return(m,o)=>(f(),_(z,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=n=>x.value=n),"max-width":"500",persistent:""},{default:a(()=>[e(N,null,{default:a(()=>[e(R,{class:"d-flex align-center"},{default:a(()=>[e(y,{icon:l(s)?"mdi-pencil":"mdi-plus",class:"mr-2"},null,8,["icon"]),i(" "+E(l(s)?"Edit Cemetery":"New Cemetery"),1)]),_:1}),e(S,null,{default:a(()=>[e(X,{ref_key:"formRef",ref:w,onSubmit:Y(D,["prevent"])},{default:a(()=>[e(Z,{modelValue:l(r).name,"onUpdate:modelValue":o[0]||(o[0]=n=>l(r).name=n),label:"Cemetery Name",rules:[n=>!!n||"Name is required"],required:""},null,8,["modelValue","rules"]),e(H,{modelValue:l(r).address,"onUpdate:modelValue":o[1]||(o[1]=n=>l(r).address=n),label:"Address",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),e(j,null,{default:a(()=>[e(O),e(p,{variant:"text",onClick:b},{default:a(()=>[...o[3]||(o[3]=[i("Cancel",-1)])]),_:1}),e(p,{color:"primary",loading:l(u),onClick:D},{default:a(()=>[i(E(l(s)?"Save":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),me=Object.assign(ue,{__name:"CemeteryDialog"}),ye=U({__name:"cemeteries",async setup(A){let C,g;const{data:T,pending:x,refresh:w}=([C,g]=K(()=>ie("/api/cemeteries","$S7IxEoJr7z")),C=await C,g(),C),u=v(!1),s=v(!1),r=v(null),V=v(null),k=v(!1),b=P("showSnackbar");function D(){r.value=null,u.value=!0}function m(c){r.value=c,u.value=!0}function o(){w()}function n(c){V.value=c,s.value=!0}async function B(){if(V.value){k.value=!0;try{await $fetch(`/api/cemeteries/${V.value.id}`,{method:"DELETE"}),b?.("Cemetery deleted"),w(),s.value=!1}catch(c){console.error("Error deleting cemetery:",c);const t=c instanceof Error?c.message:"Failed to delete cemetery";b?.(t,"error")}finally{k.value=!1}}}return(c,t)=>{const q=me;return f(),L("div",null,[e(N,{class:"mb-4"},{default:a(()=>[e(S,null,{default:a(()=>[e(h,{align:"center"},{default:a(()=>[e(I,null,{default:a(()=>[...t[3]||(t[3]=[$("div",{class:"text-h6"},"Cemeteries",-1),$("div",{class:"text-body-2 text-medium-emphasis"}," Manage cemetery locations ",-1)])]),_:1}),e(I,{cols:"auto"},{default:a(()=>[e(p,{color:"primary",onClick:D},{default:a(()=>[e(y,{icon:"mdi-plus",start:""}),t[4]||(t[4]=i(" New Cemetery ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(N,null,{default:a(()=>[l(x)?(f(),_(S,{key:0},{default:a(()=>[e(ee,{type:"list-item-two-line@5"})]),_:1})):l(T)?.length?(f(),_(ae,{key:1},{default:a(()=>[(f(!0),L(te,null,le(l(T),d=>(f(),_(oe,{key:d.id},{prepend:a(()=>[e(de,{color:"primary"},{default:a(()=>[e(y,{icon:"mdi-map-marker"})]),_:1})]),append:a(()=>[e(p,{icon:"",variant:"text",size:"small",onClick:J=>m(d)},{default:a(()=>[e(y,{icon:"mdi-pencil"})]),_:1},8,["onClick"]),e(p,{icon:"",variant:"text",size:"small",color:"error",onClick:J=>n(d)},{default:a(()=>[e(y,{icon:"mdi-delete"})]),_:1},8,["onClick"])]),default:a(()=>[e(re,{class:"font-weight-medium"},{default:a(()=>[i(E(d.name),1)]),_:2},1024),d.address?(f(),_(ne,{key:0},{default:a(()=>[i(E(d.address),1)]),_:2},1024)):se("",!0)]),_:2},1024))),128))]),_:1})):(f(),_(S,{key:2,class:"text-center py-8"},{default:a(()=>[e(y,{icon:"mdi-map-marker",size:"64",color:"grey-lighten-1"}),t[6]||(t[6]=$("div",{class:"text-h6 mt-4"},"No cemeteries yet",-1)),t[7]||(t[7]=$("div",{class:"text-body-2 text-medium-emphasis mb-4"}," Add your first cemetery location ",-1)),e(p,{color:"primary",onClick:D},{default:a(()=>[e(y,{icon:"mdi-plus",start:""}),t[5]||(t[5]=i(" Add Cemetery ",-1))]),_:1})]),_:1}))]),_:1}),e(q,{modelValue:l(u),"onUpdate:modelValue":t[0]||(t[0]=d=>M(u)?u.value=d:null),cemetery:l(r),onSaved:o},null,8,["modelValue","cemetery"]),e(z,{modelValue:l(s),"onUpdate:modelValue":t[2]||(t[2]=d=>M(s)?s.value=d:null),"max-width":"400"},{default:a(()=>[e(N,null,{default:a(()=>[e(R,{class:"d-flex align-center"},{default:a(()=>[e(y,{icon:"mdi-alert",color:"error",class:"mr-2"}),t[8]||(t[8]=i(" Delete Cemetery ",-1))]),_:1}),e(S,null,{default:a(()=>[i(' Are you sure you want to delete "'+E(l(V)?.name)+'"? This action cannot be undone. ',1)]),_:1}),e(j,null,{default:a(()=>[e(O),e(p,{variant:"text",onClick:t[1]||(t[1]=d=>s.value=!1)},{default:a(()=>[...t[9]||(t[9]=[i("Cancel",-1)])]),_:1}),e(p,{color:"error",loading:l(k),onClick:B},{default:a(()=>[...t[10]||(t[10]=[i(" Delete ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{ye as default};
