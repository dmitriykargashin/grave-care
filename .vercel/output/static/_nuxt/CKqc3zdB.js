import{d as G,ag as w,ah as M,r as f,k as $,ao as x,ai as N,W as A,C as i,af as B,y as P,B as s,aj as j,D as p,M as E,_ as l,A as _,ak as z,al as O,am as J,az as b,Y as k,ad as Q,an as W,$ as Y,J as R,P as Z,G as H}from"./CqnZqnHT.js";import{u as S}from"./CPSzfpNf.js";const K=G({__name:"GraveDialog",props:w({grave:{},prefillCemeteryId:{},prefillCustomerId:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:w(["saved"],["update:modelValue"]),async setup(V,{emit:q}){let d,m;const o=V,T=q,n=M(V,"modelValue"),v=f(),c=f(!1),u=$(()=>!!o.grave?.id),t=f({cemeteryId:"",customerId:"",plotRef:"",deceasedName:"",specialInstructions:""}),{data:U}=([d,m]=x(()=>S("/api/cemeteries","$EowNjxQ9F_")),d=await d,m(),d),{data:D}=([d,m]=x(()=>S("/api/customers","$m9ryzeAZqV")),d=await d,m(),d),I=H("showSnackbar");N(()=>o.grave,r=>{r?t.value={cemeteryId:r.cemeteryId,customerId:r.customerId,plotRef:r.plotRef,deceasedName:r.deceasedName||"",specialInstructions:r.specialInstructions||""}:y()},{immediate:!0}),N(()=>n.value,r=>{r&&!o.grave&&(o.prefillCemeteryId&&(t.value.cemeteryId=o.prefillCemeteryId),o.prefillCustomerId&&(t.value.customerId=o.prefillCustomerId))});function y(){t.value={cemeteryId:o.prefillCemeteryId||"",customerId:o.prefillCustomerId||"",plotRef:"",deceasedName:"",specialInstructions:""}}function C(){n.value=!1,y()}async function g(){const{valid:r}=await v.value.validate();if(r){c.value=!0;try{const a=u.value?`/api/graves/${o.grave.id}`:"/api/graves",e=u.value?"PUT":"POST",F=await $fetch(a,{method:e,body:t.value});T("saved",F),I?.(`Grave ${u.value?"updated":"created"} successfully`),C()}catch(a){console.error("Error saving grave:",a),I?.("Failed to save grave","error")}finally{c.value=!1}}}return(r,a)=>(P(),A(B,{modelValue:n.value,"onUpdate:modelValue":a[5]||(a[5]=e=>n.value=e),"max-width":"600",persistent:""},{default:i(()=>[s(Z,null,{default:i(()=>[s(j,{class:"d-flex align-center"},{default:i(()=>[s(E,{icon:l(u)?"mdi-pencil":"mdi-plus",class:"mr-2"},null,8,["icon"]),p(" "+_(l(u)?"Edit Grave":"New Grave"),1)]),_:1}),s(z,null,{default:i(()=>[s(O,{ref_key:"formRef",ref:v,onSubmit:J(g,["prevent"])},{default:i(()=>[s(b,{modelValue:l(t).cemeteryId,"onUpdate:modelValue":a[0]||(a[0]=e=>l(t).cemeteryId=e),items:l(U),"item-title":"name","item-value":"id",label:"Cemetery",rules:[e=>!!e||"Cemetery is required"],required:""},null,8,["modelValue","items","rules"]),s(b,{modelValue:l(t).customerId,"onUpdate:modelValue":a[1]||(a[1]=e=>l(t).customerId=e),items:l(D),"item-title":"fullName","item-value":"id",label:"Customer",rules:[e=>!!e||"Customer is required"],required:""},null,8,["modelValue","items","rules"]),s(k,{modelValue:l(t).plotRef,"onUpdate:modelValue":a[2]||(a[2]=e=>l(t).plotRef=e),label:"Plot Reference",rules:[e=>!!e||"Plot reference is required"],required:""},null,8,["modelValue","rules"]),s(k,{modelValue:l(t).deceasedName,"onUpdate:modelValue":a[3]||(a[3]=e=>l(t).deceasedName=e),label:"Deceased Name"},null,8,["modelValue"]),s(Q,{modelValue:l(t).specialInstructions,"onUpdate:modelValue":a[4]||(a[4]=e=>l(t).specialInstructions=e),label:"Special Instructions",rows:"3"},null,8,["modelValue"])]),_:1},512)]),_:1}),s(W,null,{default:i(()=>[s(Y),s(R,{variant:"text",onClick:C},{default:i(()=>[...a[6]||(a[6]=[p("Cancel",-1)])]),_:1}),s(R,{color:"primary",loading:l(c),onClick:g},{default:i(()=>[p(_(l(u)?"Save":"Create"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),h=Object.assign(K,{__name:"GraveDialog"});export{h as _};
