import{T as V,b as W,a as h,_ as Z}from"./TP-IniU1.js";import{d as ee,a5 as te,r as b,k as D,I as ae,x as U,B as a,C as s,V as z,J as i,$ as le,G as se,y as g,K as oe,aa as ie,_ as p,D as d,z as n,M as y,q as re,N,O as ne,A as u,a4 as I,a6 as ue,X as O,Q as de,R as me,S as pe,T as ce,U as fe,ab as ye}from"./DSoo6jVJ.js";import{u as ve,a as Ve,V as c,c as ge}from"./BxkK-uK3.js";import{V as T,a as ke}from"./D9WYUSSA.js";import{V as _e}from"./BLiBMJ1o.js";import{_ as be}from"./DlAUqK2U.js";import"./CDhTuRGa.js";const Te={class:"text-capitalize"},Se={class:"font-weight-medium"},Ce={class:"text-caption text-medium-emphasis"},xe={class:"text-center py-8"},Fe={class:"text-body-2 text-medium-emphasis mb-4"},we=ee({__name:"index",async setup(he){let v,S;const P=te(),o=b({search:"",status:null,type:null,priority:null,dateFilter:P.query.dateFilter||"all"}),R=D(()=>{const e={};return o.value.search&&(e.q=o.value.search),o.value.status&&(e.status=o.value.status),o.value.type&&(e.type=o.value.type),o.value.priority&&(e.priority=o.value.priority),o.value.dateFilter&&o.value.dateFilter!=="all"&&(e.dateFilter=o.value.dateFilter),e}),{data:A,pending:B,refresh:m}=([v,S]=ae(()=>ve("/api/tasks",{query:R},"$UNyguHxu0T")),v=await v,S(),v),f=b(!1),k=b(null),C=se("showSnackbar"),$=[{title:"Title",key:"title",sortable:!0},{title:"Type",key:"type",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Priority",key:"priority",sortable:!0},{title:"Scheduled",key:"scheduledFor",sortable:!0},{title:"Grave",key:"grave",sortable:!1},{title:"",key:"actions",sortable:!1,width:50}],E=V.map(e=>({title:e.title,value:e.value})),L=W.map(e=>({title:e.title,value:e.value})),q=h.map(e=>({title:e.title,value:e.value})),x=D(()=>o.value.search||o.value.status||o.value.type||o.value.priority||o.value.dateFilter!=="all");let F;function K(){clearTimeout(F),F=setTimeout(()=>m(),300)}function M(e){return V.find(t=>t.value===e)?.color||"grey"}function j(e){return V.find(t=>t.value===e)?.title||e}function G(e){return h.find(t=>t.value===e)?.color||"grey"}function H(e){return e?new Date(e).toLocaleDateString():"-"}function J(e){return!e.scheduledFor||e.status==="done"||e.status==="canceled"?!1:new Date(e.scheduledFor)<new Date(new Date().toDateString())}function w(){k.value=null,f.value=!0}function Q(e){k.value=e,f.value=!0}async function X(e,t){try{await $fetch(`/api/tasks/${e}/status`,{method:"POST",body:{status:t}}),C?.("Status updated"),m()}catch(_){console.error("Error updating status:",_),C?.("Failed to update status","error")}}function Y(){m()}return(e,t)=>{const _=Z;return g(),U("div",null,[a(z,{class:"mb-4"},{default:s(()=>[a(oe,null,{default:s(()=>[a(Ve,{align:"center"},{default:s(()=>[a(c,{cols:"12",sm:"6",md:"3"},{default:s(()=>[a(ge,{modelValue:i(o).search,"onUpdate:modelValue":[t[0]||(t[0]=l=>i(o).search=l),K],"prepend-inner-icon":"mdi-magnify",label:"Search tasks...","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(c,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(T,{modelValue:i(o).status,"onUpdate:modelValue":[t[1]||(t[1]=l=>i(o).status=l),i(m)],items:i(E),label:"Status","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(c,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(T,{modelValue:i(o).type,"onUpdate:modelValue":[t[2]||(t[2]=l=>i(o).type=l),i(m)],items:i(L),label:"Type","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(c,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(T,{modelValue:i(o).priority,"onUpdate:modelValue":[t[3]||(t[3]=l=>i(o).priority=l),i(m)],items:i(q),label:"Priority","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(c,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(ie,{modelValue:i(o).dateFilter,"onUpdate:modelValue":t[4]||(t[4]=l=>i(o).dateFilter=l),mandatory:"",color:"primary",density:"comfortable"},{default:s(()=>[a(p,{value:"all",size:"small"},{default:s(()=>[...t[8]||(t[8]=[d("All",-1)])]),_:1}),a(p,{value:"upcoming",size:"small"},{default:s(()=>[...t[9]||(t[9]=[d("Upcoming",-1)])]),_:1}),a(p,{value:"overdue",size:"small"},{default:s(()=>[...t[10]||(t[10]=[d("Overdue",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(c,{cols:"12",md:"1",class:"text-right"},{default:s(()=>[a(p,{color:"primary",onClick:w},{default:s(()=>[a(y,{icon:"mdi-plus"}),t[11]||(t[11]=n("span",{class:"d-none d-md-inline ml-2"},"New",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:s(()=>[a(_e,{headers:$,items:i(A)||[],loading:i(B),"items-per-page":15,hover:"","onClick:row":t[6]||(t[6]=(l,{item:r})=>("navigateTo"in e?e.navigateTo:i(re))(`/tasks/${r.id}`))},{"item.status":s(({item:l})=>[a(ke,null,{activator:s(({props:r})=>[a(O,ye(r,{color:M(l.status),size:"small",class:"cursor-pointer",onClick:t[5]||(t[5]=I(()=>{},["stop"]))}),{default:s(()=>[d(u(j(l.status))+" ",1),a(y,{icon:"mdi-menu-down",end:"",size:"small"})]),_:2},1040,["color"])]),default:s(()=>[a(de,{density:"compact"},{default:s(()=>[(g(!0),U(me,null,pe(i(V),r=>(g(),N(ce,{key:r.value,disabled:r.value===l.status,onClick:De=>X(l.id,r.value)},{default:s(()=>[a(fe,null,{default:s(()=>[d(u(r.title),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),"item.priority":s(({item:l})=>[a(O,{color:G(l.priority),size:"small",variant:"outlined"},{default:s(()=>[d(u(l.priority),1)]),_:2},1032,["color"])]),"item.type":s(({item:l})=>[n("span",Te,u(l.type.replace("_"," ")),1)]),"item.scheduledFor":s(({item:l})=>[n("span",{class:ue({"text-error":J(l)})},u(H(l.scheduledFor)),3)]),"item.grave":s(({item:l})=>[n("div",null,[n("div",Se,u(l.deceasedName||"Unknown"),1),n("div",Ce,u(l.cemeteryName)+" Â· "+u(l.plotRef),1)])]),"item.actions":s(({item:l})=>[a(p,{icon:"",variant:"text",size:"small",onClick:I(r=>Q(l),["stop"])},{default:s(()=>[a(y,{icon:"mdi-pencil"})]),_:1},8,["onClick"])]),"no-data":s(()=>[n("div",xe,[a(y,{icon:"mdi-clipboard-text-outline",size:"64",color:"grey-lighten-1"}),t[13]||(t[13]=n("div",{class:"text-h6 mt-4"},"No tasks found",-1)),n("div",Fe,u(i(x)?"Try adjusting your filters":"Create your first task to get started"),1),i(x)?ne("",!0):(g(),N(p,{key:0,color:"primary",onClick:w},{default:s(()=>[a(y,{icon:"mdi-plus",start:""}),t[12]||(t[12]=d(" Create Task ",-1))]),_:1}))])]),_:1},8,["items","loading"])]),_:1}),a(_,{modelValue:i(f),"onUpdate:modelValue":t[7]||(t[7]=l=>le(f)?f.value=l:null),task:i(k),onSaved:Y},null,8,["modelValue","task"])])}}}),Ae=be(we,[["__scopeId","data-v-a51d1556"]]);export{Ae as default};
