import{T as V,b as Z,a as h,_ as Q}from"./DHKPLmpm.js";import{d as ee,aq as te,r as b,k as D,ao as ae,x as U,B as a,C as s,P as z,_ as i,Z as le,G as se,y as g,ak as oe,V as ie,I as p,Y as re,au as T,av as ne,J as c,D as d,z as n,M as y,aw as ue,q as de,W as N,X as me,A as u,am as P,a3 as pe,a0 as I,ax as ce,a5 as fe,N as ye,O as ve,a6 as Ve,a7 as ge,ay as ke}from"./CqnZqnHT.js";import{u as _e}from"./CPSzfpNf.js";import{_ as be}from"./DlAUqK2U.js";const Te={class:"text-capitalize"},Se={class:"font-weight-medium"},xe={class:"text-caption text-medium-emphasis"},Ce={class:"text-center py-8"},we={class:"text-body-2 text-medium-emphasis mb-4"},Fe=ee({__name:"index",async setup(he){let v,S;const O=te(),o=b({search:"",status:null,type:null,priority:null,dateFilter:O.query.dateFilter||"all"}),A=D(()=>{const e={};return o.value.search&&(e.q=o.value.search),o.value.status&&(e.status=o.value.status),o.value.type&&(e.type=o.value.type),o.value.priority&&(e.priority=o.value.priority),o.value.dateFilter&&o.value.dateFilter!=="all"&&(e.dateFilter=o.value.dateFilter),e}),{data:B,pending:R,refresh:m}=([v,S]=ae(()=>_e("/api/tasks",{query:A},"$UNyguHxu0T")),v=await v,S(),v),f=b(!1),k=b(null),x=se("showSnackbar"),q=[{title:"Title",key:"title",sortable:!0},{title:"Type",key:"type",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Priority",key:"priority",sortable:!0},{title:"Scheduled",key:"scheduledFor",sortable:!0},{title:"Grave",key:"grave",sortable:!1},{title:"",key:"actions",sortable:!1,width:50}],E=V.map(e=>({title:e.title,value:e.value})),L=Z.map(e=>({title:e.title,value:e.value})),$=h.map(e=>({title:e.title,value:e.value})),C=D(()=>o.value.search||o.value.status||o.value.type||o.value.priority||o.value.dateFilter!=="all");let w;function K(){clearTimeout(w),w=setTimeout(()=>m(),300)}function M(e){return V.find(t=>t.value===e)?.color||"grey"}function j(e){return V.find(t=>t.value===e)?.title||e}function G(e){return h.find(t=>t.value===e)?.color||"grey"}function Y(e){return e?new Date(e).toLocaleDateString():"-"}function H(e){return!e.scheduledFor||e.status==="done"||e.status==="canceled"?!1:new Date(e.scheduledFor)<new Date(new Date().toDateString())}function F(){k.value=null,f.value=!0}function J(e){k.value=e,f.value=!0}async function W(e,t){try{await $fetch(`/api/tasks/${e}/status`,{method:"POST",body:{status:t}}),x?.("Status updated"),m()}catch(_){console.error("Error updating status:",_),x?.("Failed to update status","error")}}function X(){m()}return(e,t)=>{const _=Q;return g(),U("div",null,[a(z,{class:"mb-4"},{default:s(()=>[a(oe,null,{default:s(()=>[a(ie,{align:"center"},{default:s(()=>[a(p,{cols:"12",sm:"6",md:"3"},{default:s(()=>[a(re,{modelValue:i(o).search,"onUpdate:modelValue":[t[0]||(t[0]=l=>i(o).search=l),K],"prepend-inner-icon":"mdi-magnify",label:"Search tasks...","hide-details":"",clearable:""},null,8,["modelValue"])]),_:1}),a(p,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(T,{modelValue:i(o).status,"onUpdate:modelValue":[t[1]||(t[1]=l=>i(o).status=l),i(m)],items:i(E),label:"Status","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(p,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(T,{modelValue:i(o).type,"onUpdate:modelValue":[t[2]||(t[2]=l=>i(o).type=l),i(m)],items:i(L),label:"Type","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(p,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(T,{modelValue:i(o).priority,"onUpdate:modelValue":[t[3]||(t[3]=l=>i(o).priority=l),i(m)],items:i($),label:"Priority","hide-details":"",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(p,{cols:"6",sm:"3",md:"2"},{default:s(()=>[a(ne,{modelValue:i(o).dateFilter,"onUpdate:modelValue":t[4]||(t[4]=l=>i(o).dateFilter=l),mandatory:"",color:"primary",density:"comfortable"},{default:s(()=>[a(c,{value:"all",size:"small"},{default:s(()=>[...t[8]||(t[8]=[d("All",-1)])]),_:1}),a(c,{value:"upcoming",size:"small"},{default:s(()=>[...t[9]||(t[9]=[d("Upcoming",-1)])]),_:1}),a(c,{value:"overdue",size:"small"},{default:s(()=>[...t[10]||(t[10]=[d("Overdue",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(p,{cols:"12",md:"1",class:"text-right"},{default:s(()=>[a(c,{color:"primary",onClick:F},{default:s(()=>[a(y,{icon:"mdi-plus"}),t[11]||(t[11]=n("span",{class:"d-none d-md-inline ml-2"},"New",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(z,null,{default:s(()=>[a(ue,{headers:q,items:i(B)||[],loading:i(R),"items-per-page":15,hover:"","onClick:row":t[6]||(t[6]=(l,{item:r})=>("navigateTo"in e?e.navigateTo:i(de))(`/tasks/${r.id}`))},{"item.status":s(({item:l})=>[a(ce,null,{activator:s(({props:r})=>[a(I,ke(r,{color:M(l.status),size:"small",class:"cursor-pointer",onClick:t[5]||(t[5]=P(()=>{},["stop"]))}),{default:s(()=>[d(u(j(l.status))+" ",1),a(y,{icon:"mdi-menu-down",end:"",size:"small"})]),_:2},1040,["color"])]),default:s(()=>[a(fe,{density:"compact"},{default:s(()=>[(g(!0),U(ye,null,ve(i(V),r=>(g(),N(Ve,{key:r.value,disabled:r.value===l.status,onClick:De=>W(l.id,r.value)},{default:s(()=>[a(ge,null,{default:s(()=>[d(u(r.title),1)]),_:2},1024)]),_:2},1032,["disabled","onClick"]))),128))]),_:2},1024)]),_:2},1024)]),"item.priority":s(({item:l})=>[a(I,{color:G(l.priority),size:"small",variant:"outlined"},{default:s(()=>[d(u(l.priority),1)]),_:2},1032,["color"])]),"item.type":s(({item:l})=>[n("span",Te,u(l.type.replace("_"," ")),1)]),"item.scheduledFor":s(({item:l})=>[n("span",{class:pe({"text-error":H(l)})},u(Y(l.scheduledFor)),3)]),"item.grave":s(({item:l})=>[n("div",null,[n("div",Se,u(l.deceasedName||"Unknown"),1),n("div",xe,u(l.cemeteryName)+" Â· "+u(l.plotRef),1)])]),"item.actions":s(({item:l})=>[a(c,{icon:"",variant:"text",size:"small",onClick:P(r=>J(l),["stop"])},{default:s(()=>[a(y,{icon:"mdi-pencil"})]),_:1},8,["onClick"])]),"no-data":s(()=>[n("div",Ce,[a(y,{icon:"mdi-clipboard-text-outline",size:"64",color:"grey-lighten-1"}),t[13]||(t[13]=n("div",{class:"text-h6 mt-4"},"No tasks found",-1)),n("div",we,u(i(C)?"Try adjusting your filters":"Create your first task to get started"),1),i(C)?me("",!0):(g(),N(c,{key:0,color:"primary",onClick:F},{default:s(()=>[a(y,{icon:"mdi-plus",start:""}),t[12]||(t[12]=d(" Create Task ",-1))]),_:1}))])]),_:1},8,["items","loading"])]),_:1}),a(_,{modelValue:i(f),"onUpdate:modelValue":t[7]||(t[7]=l=>le(f)?f.value=l:null),task:i(k),onSaved:X},null,8,["modelValue","task"])])}}}),Ie=be(Fe,[["__scopeId","data-v-a51d1556"]]);export{Ie as default};
